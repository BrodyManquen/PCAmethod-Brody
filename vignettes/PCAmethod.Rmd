---
title: "Principal Component Analysis"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Principal Component Analysis}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, eval = FALSE}
library(PCAmethod)
```

### What to Do {.unnumbered}

* Produce a ".Rmd" file that will be the basis for a module *vignette* that you build and will bundle into a custom ***R*** package.
* Include a background section on the *statistical method/topic/data visualization procedures*
  + Explain the set of analyses demonstrating the method being explored
* Organize similarly to class modules 
* The presentation can be done from the module itself
* Bundle the data you are working with into one or more included *datasets* 
* Bundle code for least two *functions* that are called in the vignette. 
* The functions you include can be custom functions that you create, but it is also perfectly fine to use functions that you have copied from other packages and include into your own package. 
* The important thing is that you are bundling them together with your dataset and vignette for easy distribution. 
* You will want to create your own documentation for each function, as discussed in [**Module 25**](#module-25) on custom package development. 
* We are learning how to distribute shared data and code to other researchers.

### What to Turn In {.unnumbered}

* A 10-15 min presentation
* A custom **R package** that can be shared as a single file and loaded into an ***R*** workspace (e.g., using the `install.packages()` function). The package should contain:
  + A set of functions and associated function documentation.
  + One or more relevant datasets (simulated or, preferably, real data), that you use in a module vignette about your chosen topic,
  + A vignette that walks users through demonstrations of relevant analyses,
  + Appropriate METADATA for your package (e.g., information on dependencies, etc.),

> **NOTE:** [**Module 25**](#module-25) takes the user through all of the step of package development, so use it as a resource! We will work through this module during our 2nd to last class.

* One group member uploads the final **R Package**'s bundled ".gz.tar" file to **Canvas**
* All group members share the repository ***GitHub*** URL to **Canvas**.

> **NOTE:** Tony should be able to CLONE the repository and see all of the components associated with the package development.



# Principal Component Analysis {.unnumbered}

## Objectives {.unnumbered}

> This module provides an overview of how to conduct a principal component 
analysis (PCA). PCA is a statistical method used to compress high-dimensional 
(>3) data and retain the most informative aspects. This is done by transforming 
the original data into a lower-dimensional space while collating highly 
correlated variables together.

Principal component analysis is a way to analyze and draw conclusions from more than three variables. For example, we could ask what makes a graduate student happy from a data set that includes age, gender, research progress, financial stability, personal growth, health, and recognition and validation. To draw conclusions from this data set, we need to visualize and analyze this data set. Visualizing in more than three dimensions is difficult, thus visualizing graduate student well-being data with seven variables (dimensions) cannot be done efficiently. PCAs take all factors (variables), combines them in a smart way, and produces new factors that are (1) correlated with each other and (2) ranked from most important to least important. The new factors produced by PCA are called **principal components**.
How does a PCA pick its components?

PCA asks the question "How can we arrange these data points in a line and preserve as much information as possible?" 

This results in an optimization problem that tries to preserve as much information as possible.

This module was based on the following sources

* [Principal Component Analysis in R Tutorial](https://www.datacamp.com/tutorial/pca-analysis-r)

### Requirements

* All variables must be quantitative

## Principal Component Analysis {.unnumbered}

Here, we created a package for Principal Component Analysis (PCA) using existing functions.

The following code uses the **music** dataset bundled in the {} package to run a principal component analysis of **Popularity**, **danceability**, **energy**, **key**, **loudness**, **mode**, **speechiness**, **acousticness**, **instrumentalness**, **liveness**, **valence**, **tempo**, **duration_in min/ms**, **time_signature**. 

How much of the variance in the data set is explained by PC1? By PC2? Which variables contribute to PC1 (and explaining the greatest amount of variance)? 
 
```{r, eval = FALSE}
library(tidyverse)
library(ggplot2)
head(music)
```

### Step 1: Clean the data

PCA only works with numerical values. So, we need to remove **Artist Name** and **Track Name** columns. Also, the **Class** column is not relevant to the analysis since it is refers to the genres themselves.

The code below creates a new data frame with only numeric columns.

```{r, eval = FALSE}
music_clean <- music %>% tidyverse::select(-"Artist Name", -"Track Name", -"Class")
```

### `princomp` function 

`princomp()` performs a principal components analysis on the given numeric data matrix, passed in as argument x, and returns the results as an object of class princomp.

```{r}
princomp(x = as.matrix(music_clean))
```




## Add a Data Directory and Data

The **music** dataset is used for example purposes. It is derived from the [music-genre-classification train.csv](https://www.kaggle.com/datasets/purumalgi/music-genre-classification/data?select=train.csv) dataset in ***Kaggle*** and was created during a **MachineHack Hackathon**. The dataset includes 17,996 songs with 17 metrics (artist name; track name; popularity; ‘danceability’; energy; key; loudness; mode; ‘speechiness’; ‘acousticness’; ‘instrumentalness’; liveness; valence; tempo; duration in milliseconds and time_signature). **Class** is the target variable (genre) ranging from 0-11 and indicating Rock, Indie, Alt, Pop, Metal, HipHop, Alt_Music, Blues, Acoustic/Folk, Instrumental, Country, or Bollywood.

```{r, eval = FALSE}
library(tidyverse)
f <- "data/music.csv"
music <- read_csv(f, col_names = TRUE)
usethis::use_data(music, overwrite = TRUE)
# overwrite argument replaces the data if it already exists
```
